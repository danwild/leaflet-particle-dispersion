"use strict";L.ParticleDispersionLayer=(L.Layer?L.Layer:L.Class).extend({_pidIndex:0,_pLatIndex:1,_pLonIndex:0,_pDepthIndex:2,_pAgeIndex:3,_featureGroup:null,_frameIndex:0,_markers:[],_colors:null,options:{data:null,displayMode:null,startFrameIndex:0,ageColorScale:null,ageDomain:null},_map:null,_renderer:null,_pane:null,initialize:function(e){L.setOptions(this,e)},onAdd:function(e){console.log("options"),console.log(this),console.log(this.options),this._map=e,this.options.hasOwnProperty("startFrameIndex")&&(this._frameIndex=this.options.startFrameIndex),this.options.ageColorScale=this.options.ageColorScale||["green","yellow","red"],this.options.ageDomain=this.options.ageDomain||null,this._createRenderer(),this.options.displayMode&&this.setDisplayMode(this.options.displayMode)},onRemove:function(){L.DomUtil.remove(this._pane),this._renderer=null,this._featureGroup=null},setData:function(e){this.options.data=e},setDisplayMode:function(e){switch(console.log("setDisplayMode: "+e),this.options.displayMode=e,this.options.displayMode){case"EXPOSURE":this._initDisplayExposure();break;case"FINAL":this._initDisplayFinal();break;case"KEYFRAME":this._initDisplayKeyframe();break;default:console.error("Attempted to initialise with invalid displayMode: "+this.options.displayMode)}},setFrameIndex:function(e){console.log("setFrameIndex: "+e);var t=this;t._frameIndex=e;var i=Object.keys(t.options.data),o=t.options.data[i[e]];t._featureGroup&&t._featureGroup.clearLayers();for(var s=0;s<o.length;s++){var a=o[s],n=t._map.wrapLatLng([a[t._pLatIndex],a[t._pLonIndex]]),r=L.circleMarker(n,{renderer:t._renderer,stroke:!1,fillOpacity:.3,radius:8,fillColor:this._colors(a[t._pAgeIndex]).hex(),_feature:a}).bindTooltip("I love to parti-cle..",{sticky:!0});t._markers.push(r),t._featureGroup.addLayer(r)}},_createRenderer:function(){this._pane=this._map.createPane("particle-dispersion"),this._renderer=L.canvas({pane:"particle-dispersion"})},_createColors:function(){return this.options.ageDomain||(this.options.ageDomain=[0,Object.keys(this.options.data).length]),this._colors=chroma.scale(this.options.ageColorScale).domain(this.options.ageDomain),this._colors},_initDisplayFinal:function(){this._createColors()},_initDisplayExposure:function(){this._createColors()},_initDisplayKeyframe:function(){this.options.data?(this._createColors(),this._featureGroup=L.featureGroup(),this._markers=[],this.setFrameIndex(this._frameIndex),this._featureGroup.addTo(this._map)):console.error("Attempted to display keyframes but there is no data.")}}),L.particleDispersionLayer=function(e){return new L.ParticleDispersionLayer(e)};